# Experimental!
I ~ "git: https://github.com/marcos-cat/iris"
R ~ "git: https://github.com/uiua-lang/rayua"

~ {
  Glyphs
  Score â† 0
  Î± â† âˆž
  Ï‰ â† âˆž
  N â† 30
}

â”Œâ”€â•´C
  W â† Ã·â‚‚â‚…â‚… [255 255 255]
  G â† Ã·â‚‚â‚…â‚… [149 208 105]
  B â† Ã·â‚‚â‚…â‚… [84 175 252]
  Y â† Ã·â‚‚â‚…â‚… [238 194 110]
  P â† Ã·â‚‚â‚…â‚… [203 106 231]
  O â† Ã·â‚‚â‚…â‚… [220 120 82]
  C â† Ã·â‚‚â‚…â‚… [32 249 252]
â””â”€â•´

Gs â† " âŠžâˆ§âŠƒâŠ¡â†»â–½â§»â‰âŠ“âŠ™Ï€@"
Cs â† C![W Y Y P B B B G G P Y O C]

GridSize  â† 8_12
Factor    â† 100
LH        â† 4/5
GlyphSize â† â–³layout LineHeight: LH Factor@â—Œ
WorldSize â† Ã—GridSize GlyphSize

â”Œâ”€â•´Text
  Size â† 40
  Char â† 23_40
  Pos  â† 30_30

  BB â†š âŠŸâŠƒ(R~MeasureText|Ã—+â‚â§»âŠš=@\n) âŠ™Size

  DrawShade â†š I~Draw~Rect I~Color~Hex "#2F2F2F7F" +12_6 BB âŠ™(-6_3 Pos)

  D â†š âŠƒ(
    I~Draw~TextâŠ™SizeâŠ™Pos
  | â‹…DrawShade
  )

  Î± â† $ Welcome to Uiua Bejeweled
      $ Press space to start,
      $ reach 10000 points to win!

  DrawWelcome â† D Orange Î±

  Î»â‚ â† $$ You lost :( You got _/10000
       $$ points, but have no swaps
       $$ left! Press space to restart
       $$ or escape to exit.

  Î»â‚‚ â† $$ You lost :( You got _/10000
       $$ points! There are no valid
       $$ moves left. Press space to
       $$ restart or escape to exit.

  DrawGameOver â† D I~Color~Hex "#FFFFFF" â¨¬Î»â‚ Î»â‚‚ >â‚€

  Ï‰ â† $$ You won! :) You got _ points!
      $$ You had _ moves left!
      $$ Press space to restart
      $$ or escape to exit.

  DrawWin â† D Green Ï‰

  Stats â† (
    $"Score: _\nSwaps: _" âŠƒScore N
    D I~Color~Hex "#FFFFFF"
  )
â””â”€â•´

Gen â† âŒŠâœ-â‚Ã—â§»Gs gen GridSize

Îº â† Ã—3e2âŠ“â§»â–¡âŠƒâŠšâ–½Ã—âˆŠAâ‚‚âŠ¸â‰¡(âŠƒâŠ¢/â‰â§ˆ-â†)â§…â‚ƒ>
Ïƒ â† :âŠ“/â—‡+(âœâŠ¡â‰¡â‹…0â—´/âŠ‚/â—‡âŠ‚)âŠœÎºâŠ¸Â°ËœâŠ¡
S â† âœScore+ âœGlyphs Ïƒ

Î´ â†š â¥(âœâŠœâ–¡âšâ‡ŒâŠ¸â¦·[Â¤WÂ¤0])âˆž
G â† âœGlyphs Î´

Ï† â†š +Ã—Genâš‚âŠ¸=â‚€
F â† âœGlyphs Ï†

Fall â† âœGlyphs(âœâŠœâ–¡âšâ‡ŒâŠ¸â¦·[Â¤WÂ¤0])
Fill â† âœGlyphsâœâŠ¢(+Ã—âŒŠâœ-â‚Ã—â§»Gs genâŠ£GridSizeâš‚âŠ¸=â‚€)

Valid â† (
  Glyphs
  âŸœâ‡Œ2_1Â°âŠ¡
  âˆ©/âŠ‚âˆ©âŒŸâ§ˆâˆ˜
  âŠ‚âŠ™â¤¸âŠ™0_2
  â‰¡âŒŸâœâŠ¡â‡Œ
  /âˆ¨â‹…â‰ â‚€â‰¡Ïƒ
)

Slot â† â¨¬âœÏ‰â—ŒâœÎ±â—Œâ‰âˆžâŠ¸Î± : âŒŠÃ·GlyphSize âŠŸÂ°Ëœâ„‚

I~Open â‡ŒWorldSize "Bejeweled"
Â°I~Screen~FPS 10

Render â† â¥â‚‚/â‰¡âŠ‚ â‰¡â‰¡(layout Color: LineHeight: LH)âŠ™Factor âˆ©âŒžâŠâŠ™CsâŠ™Gs Glyphs

ð“£ â† I~Texture~LoadImage â†¯âŠ‚WorldSize 4 0

DrawGlyphs â† I~Texture~DrawScreen Â°âŠ¸I~Texture~Image Render âŠ™ð“£

DrawSelected â† âŠƒ(
  I~Draw~Rect âŠ‚âŠ™0.2 Blue âˆ©â‡ŒâŸœÃ—GlyphSize Î±
| I~Draw~Rect âŠ‚âŠ™0.2 Orange âˆ©â‡ŒâŸœÃ—GlyphSize Ï‰
)

â”Œâ”€â•´State
  |Begin
  |Waiting
  |Swapping
  |Scoring
  |GameOver
  |Winning
  |Falling
  |Filling
â””â”€â•´

Ï â† (
  (â¢â‹…^0(Â¬Valid) ^0)!(â¥(F âŠ“Gâ—Œ âœGlyphs Ïƒ)âˆž New Genâš‚)
)

Restart! â† â¨¬^0(State~Waitingâ‹…Ï) I~Key~Pressed @\s

Step â† â¨¬(
  # START
  â¨¬State~Begin State~Waiting âˆŠâŠ™@\s I~Key~Typed

  Text~DrawWelcome
| # WAIT
  I~Mouse!Pressedâ€¼Left Slot
  â¨¬State~Waiting State~Swapping Ã—âˆ©(Â¬â‰âˆž)âŠ¸âŠƒÎ± Ï‰

  âŠ™âŠ¸DrawGlyphs
  âŠ™âŠ¸DrawSelected
  âŠ™âŠ¸Text~Stats
| # SWAP
  â¨¬(State~Waiting â—Œ
  | â¤šâ‰âŠ¸SâŠ¸(âœâŠ™GlyphsâœâŠ¡â‡Œ)
    â¨¬(State~Falling âœN-â‚
    | State~Waiting â‹…âˆ˜
    )
  )âˆŠAâ‚‚âŠƒ-âŠŸâŠƒ(Î±|Ï‰|âœÏ‰â‹…âˆžâœÎ±â‹…âˆž)

  âŠ™âŠ¸DrawGlyphs
  âŠ™âŠ¸Text~Stats
| # SCORE
  â¨¬(State~Winning
  | â¨¬(State~GameOver
    | â¨¬(State~Falling
      | State~Waiting
      )â¤šâ‰âŠ¸S
    )Ã—âŠ¸âŠƒ(>â‚€N|Valid)
  )<1e4âŠ¸Score

  âŠ™âŠ¸DrawGlyphs
  âŠ™âŠ¸Text~Stats
| # LOSE
  Restart!State~GameOver

  âŠ™âŠ¸DrawGlyphs
  âŠ™âŠ¸âŠƒN Score
  âŠ™Text~DrawGameOver
| # WIN
  Restart!State~Winning

  âŠ™âŠ¸DrawGlyphs
  âŠ™âŠ¸âŠƒScore N
  âŠ™Text~DrawWin
| # FALLING
  â¨¬(State~Scoring âˆ˜
  | State~Filling Fall
  )/âˆ¨â™­=â‚€âŠ¸Glyphs

  âŠ™âŠ¸DrawGlyphs
  âŠ™âŠ¸Text~Stats
| # FILLING
  State~Falling Fill

  âŠ™âŠ¸DrawGlyphs
  âŠ™âŠ¸Text~Stats
)

State~Begin Ï
â—Œâ—ŒI~Loop!(Step I~Draw~Background I~Color~Clear)
