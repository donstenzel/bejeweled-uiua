# Experimental!
I ~ "git: https://github.com/marcos-cat/iris"
  Hx â† I~Color~Hex
R ~ "git: https://github.com/uiua-lang/rayua"

â”Œâ”€â•´C
  W â† Ã·â‚‚â‚…â‚… [255 255 255]
  G â† Ã·â‚‚â‚…â‚… [149 208 105]
  B â† Ã·â‚‚â‚…â‚… [84 175 252]
  Y â† Ã·â‚‚â‚…â‚… [238 194 110]
  P â† Ã·â‚‚â‚…â‚… [203 106 231]
  O â† Ã·â‚‚â‚…â‚… [220 120 82]
  C â† Ã·â‚‚â‚…â‚… [32 249 252]
â””â”€â•´

GridSize  â† 8_12
Factor    â† 100
LH        â† 4/5
GlyphSize â† â–³layout LineHeight: LH Factor@â—Œ
WorldSize â† Ã—GridSize GlyphSize

â”Œâ”€â•´Text
  Size â† 40
  Pos  â† 30_30

  Î± â† $ Welcome to Uiua Bejeweled
      $ Press space to start,
      $ reach 10000 points to win!

  Î»â‚ â† $$ You lost :( You got _/10000
       $$ points, but have no swaps
       $$ left! Press space to restart
       $$ or escape to exit.

  Î»â‚‚ â† $$ You lost :( You got _/10000
       $$ points! There are no valid
       $$ moves left. Press space to
       $$ restart or escape to exit.

  Ï‰ â† $$ You won! :) You got _ points!
      $$ You had _ moves left!
      $$ Press space to restart
      $$ or escape to exit.
â””â”€â•´

Cs â† C![W G B Y P O C]
Gs â† {" " "â‰â§»â–³" "Ã·âŠ¡âŠ—" "â—‡â§…âŠ•" "âŠƒâŠ“" "Î·Ï€Ï„âˆž" "@$"}

~ {
  Glyphs
  ð’® â† 0
  Î± â† âˆž
  Ï‰ â† âˆž
  N â† 30
}

Gen â† âœÂ°Ëœ+â¤š(
  âœÃ—âŒŠ â‰¡â‚€â—‡â§»âŠâŠ™Gs
)âœ-â‚Ã—â§»Cs gen

Split â† : â‰¡â‚€â—‡(âŠâ…Ã—âŠ™âŠ¸â§») âŠ™(âˆ©âŒžâŠ|Gs Cs) Â°+

Îº â† âŠƒ(â–¡â—´/âŠ‚â–½|Ã—3e2â§»âŠš)Ã—âˆŠAâ‚‚âŠ¸â‰¡(âŠƒâŠ¢/â‰â§ˆ-â†)â§…â‚ƒ>
Ïƒ â† âŠƒð„(âœâŠ¡Ã—â‚€/â—‡âŠ‚)â‹…/+âŠœÎºâŠƒâŒŠÂ°âŠ¡

Score â† âœð’® + âœGlyphs Ïƒ
Fall  â† âœGlyphs(âœâŠœâ–¡âšâ‡ŒâŠ¸â¦·[Â¤WÂ¤0])
Fill  â† âœGlyphsâœâŠ¢(+Ã—GenâŠ™âš‚âŠ¸âŠƒâ§»=â‚€)

Valid â† (
  âŸœâ‡Œ2_1Â°âŠ¡ Glyphs
  âŠ‚âŠ™â¤¸âŠ™0_2 âˆ©/âŠ‚âˆ©âŒŸâ§ˆâˆ˜
  /âˆ¨â‹…â‰ â‚€â‰¡Ïƒ â‰¡âŒŸâœâŠ¡â‡Œ
)

Slot â† â¨¬âœÏ‰â—ŒâœÎ±â—Œâ‰âˆžâŠ¸Î± : âŒŠÃ·GlyphSize âŠŸÂ°Ëœâ„‚

Render â† â¥â‚‚/â‰¡âŠ‚ â‰¡â‰¡(layout Color: LineHeight: LH) âŠ™Factor Split Glyphs

I~Open â‡ŒWorldSize "Bejeweled"
Â°I~Screen~FPS 10

ð“£ â† I~Texture~LoadImage â†¯âŠ‚WorldSize 4 0

â”Œâ”€â•´Draw
  BB â† âŠŸâŠƒ(R~MeasureText|Ã—+â‚â§»âŠš=@\n)

  Glyphs â† I~Texture~DrawScreen Â°âŠ¸I~Texture~Image Render âŠ™ð“£

  Selected â† âŠƒ(
    I~Draw~Rect âŠ‚âŠ™0.2 Blue âˆ©â‡ŒâŸœÃ—GlyphSize Î±
  | I~Draw~Rect âŠ‚âŠ™0.2 Orange âˆ©â‡ŒâŸœÃ—GlyphSize Ï‰
  )

  Shade â† I~Draw~Rect Hx "#2F2F2F7F" +16_8 âŠƒð„ËœBB(-â‹…8_4)

  TextBx â† âŠƒI~Draw~Textâ‹…Shade âŠ™Text!(Size Pos)

  Start â† TextBx Hx "#aed7a3" Text~Î±

  Stats â† TextBx Hx "#FFFFFF" $"Score: _\nSwaps: _" âŠƒð’® N

  GameOver â† TextBx Hx "#FFFFFF" Text!â¨¬Î»â‚ Î»â‚‚ >â‚€ âŠƒN ð’®

  Win â† TextBx Green Text~Ï‰ âŠƒð’® N
â””â”€â•´

â”Œâ”€â•´State
  |Begin
  |Waiting
  |Swapping
  |Scoring
  |GameOver
  |Winning
  |Falling
  |Filling
â””â”€â•´

Ï â† (
  (â¢â‹…^0(Â¬Valid) ^0)!(â¥(Fall âŠ“Fillâ—Œ âœGlyphs Ïƒ)âˆž New Gen GridSize âš‚)
)

Restart! â† â¨¬^0(State~Waitingâ‹…Ï) I~Key~Pressed @\s

Step â† â¨¬(
  # START
  â¨¬State~Begin State~Waiting âˆŠâŠ™@\s I~Key~Typed

  Draw~Start
| # WAIT
  I~Mouse!Pressedâ€¼Left Slot
  â¨¬State~Waiting State~Swapping Ã—âˆ©(Â¬â‰âˆž)âŠ¸âŠƒÎ± Ï‰

  âŠ™âŠ¸Draw~Glyphs
  âŠ™âŠ¸Draw~Selected
  âŠ™âŠ¸Draw~Stats
| # SWAP
  â¨¬(State~Waiting â—Œ
  | â¨¬(State~Falling âœN-â‚
    | State~Waiting â‹…âˆ˜
    )â¤šâ‰âŠ¸ScoreâŠ¸âœâŠ™GlyphsâœâŠ¡â‡Œ
  )âˆŠAâ‚‚âŠƒ-âŠŸâŠƒ(Î±|Ï‰|âœÏ‰â‹…âˆžâœÎ±â‹…âˆž)

  âŠ™âŠ¸Draw~Glyphs
  âŠ™âŠ¸Draw~Stats
| # SCORE
  â¨¬(State~Winning
  | â¨¬(State~GameOver
    | â¨¬(State~Falling
      | State~Waiting
      )â¤šâ‰âŠ¸Score
    )Ã—âŠ¸âŠƒ(>â‚€N|Valid)
  )<1e4âŠ¸ð’®

  âŠ™âŠ¸Draw~Glyphs
  âŠ™âŠ¸Draw~Stats
| # LOSE
  Restart!State~GameOver

  âŠ™âŠ¸Draw~Glyphs
  âŠ™âŠ¸Draw~GameOver
| # WIN
  Restart!State~Winning

  âŠ™âŠ¸Draw~Glyphs
  âŠ™âŠ¸Draw~Win
| # FALLING
  â¨¬(State~Scoring âˆ˜
  | State~Filling Fall
  )/âˆ¨â™­=â‚€âŠ¸Glyphs

  âŠ™âŠ¸Draw~Glyphs
  âŠ™âŠ¸Draw~Stats
| # FILLING
  State~Falling Fill

  âŠ™âŠ¸Draw~Glyphs
  âŠ™âŠ¸Draw~Stats
)

State~Begin Ï
â—Œâ—ŒI~Loop!(Step I~Draw~Background I~Color~Clear)
